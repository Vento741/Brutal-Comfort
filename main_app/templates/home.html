{% extends 'base.html' %}
{% load static %}
{% block title %}Главная - Бутик авторской кухни и мебели Бруталь-Комфорт{% endblock %}

{% block content %}
<div class="home-hero">
    <div class="hero-content">
        <h1 class="display-4">Добро пожаловать в наш бутик авторской кухни и мебели Бруталь-Комфорт</h1>
        <p class="lead">Создаем уникальные интерьеры, воплощая ваши мечты в реальность</p>
        <hr class="my-4">
        <p>Закажите консультацию нашего дизайнера и начните путь к дому вашей мечты</p>
        <a class="btn btn-primary btn-lg" href="{% url 'consultation' %}" role="button">Заказать консультацию</a>
    </div>
</div>

<section class="featured-projects">
    <h2 class="text-center mb-4">Избранные проекты</h2>
    <div class="row">
        {% for project in featured_projects %}
        <div class="col-md-3 mb-4">
            {% if project.image %}
            <img src="{{ project.image.url }}" class="card-img-top" alt="{{ project.title }}" data-src="{{ project.image.url }}">
            {% else %}
                <img src="{% static 'images/placeholder.jpg' %}" class="card-img-top" alt="Placeholder">
            {% endif %}
            <div class="card">
                <img src="{{ project.image.url }}?{% now "U" %}" class="card-img-top" alt="{{ project.title }}">
                <div class="card-body">
                    <h5 class="card-title">{{ project.title }}</h5>
                    <p class="card-text">{{ project.description|truncatewords:20 }}</p>
                    <a href="{% url 'projects' %}" class="btn btn-outline-primary">Подробнее</a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <p>На данный момент избранных проектов нет.</p>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let lazyImages = [].slice.call(document.querySelectorAll("img.lazy-load"));
    
    if ("IntersectionObserver" in window) {
        let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    let lazyImage = entry.target;
                    lazyImage.src = lazyImage.dataset.src + '?t=' + new Date().getTime();
                    lazyImage.classList.remove("lazy-load");
                    lazyImageObserver.unobserve(lazyImage);
                }
            });
        });

        lazyImages.forEach(function(lazyImage) {
            lazyImageObserver.observe(lazyImage);
        });
    } else {
        // Fallback for browsers that don't support IntersectionObserver
        lazyImages.forEach(function(lazyImage) {
            lazyImage.src = lazyImage.dataset.src + '?t=' + new Date().getTime();
            lazyImage.classList.remove("lazy-load");
        });
    }
});
</script>
{% endblock %}